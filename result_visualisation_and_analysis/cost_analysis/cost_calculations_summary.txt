====================================================================================================
COST ANALYSIS CALCULATIONS SUMMARY
====================================================================================================

This document provides a complete reference for all calculations and metrics used in the cost
analysis subdirectory.

====================================================================================================
1. BASIC COST METRICS
====================================================================================================

Stage 2 Extraction Cost (USD)
  - Direct cost from LLM API calls during entity/relationship extraction
  - Formula: Sum of all extraction API costs for a document/method
  - Source: stage2_*_cost_report.json files

Stage 3 Validation Cost (USD)
  - Direct cost from LLM API calls during validation phase
  - Formula: Sum of all validation API costs for a document
  - Source: stage3_*_validation_summary.json files

Total Pipeline Cost (USD)
  - Combined cost of extraction and validation
  - Formula: Stage 2 Cost + Stage 3 Cost
  - Used for: Overall cost comparisons between methods

====================================================================================================
2. ENTITY METRICS
====================================================================================================

Total Entities Extracted
  - Number of entities extracted in Stage 2
  - Source: Entity count from Stage 2 extraction outputs
  - Used in: Retention rate and waste calculations

Validated Entities
  - Number of entities that passed Stage 3 validation
  - Source: Entity count from Stage 3 validated outputs
  - Used in: Cost efficiency calculations

Filtered Entities
  - Number of entities removed during validation
  - Formula: Total Entities Extracted - Validated Entities
  - Used in: Waste calculations

Retention Rate (%)
  - Percentage of extracted entities that passed validation
  - Formula: (Validated Entities / Total Entities Extracted) × 100%
  - Example: 66/74 × 100% = 89.19%

====================================================================================================
3. COST EFFICIENCY METRICS (SIMPLIFIED)
====================================================================================================

Cost per Validated Entity (USD/entity)
  - How much it costs to produce one validated entity
  - Formula: Total Pipeline Cost / Validated Entities
  - Lower is better
  - Example (Baseline): $4.4820 / 28 entities = $0.1594/entity
  - Example (Ontology-Guided): $4.5615 / 295 entities = $0.0155/entity

  Interpretation:
    - Ontology-Guided is 10.3x more cost-efficient than Baseline
    - Main metric for comparing pipeline efficiency

Cost Waste Ratio (%)
  - Percentage of effort spent on entities that get filtered out
  - Formula: (Filtered Entities / Total Entities Extracted) × 100%
  - Lower is better
  - Example (Baseline): (336/364) × 100% = 92.31% → 97.23% (weighted by cost)
  - Example (Ontology-Guided): (69/364) × 100% = 18.96% → 18.80% (weighted by cost)

  Interpretation:
    - Baseline wastes 97.23% of extraction effort
    - Ontology-Guided wastes only 18.80% of extraction effort
    - Shows quality improvement from ontology guidance

====================================================================================================
4. WASTED COST CALCULATION
====================================================================================================

Wasted Cost (USD)
  - Cost spent on extracting entities that later get filtered out
  - Proportional allocation based on filtered entity ratio
  - Formula: Total Pipeline Cost × (Filtered Entities / Total Entities Extracted)

  Step-by-step example (SASB Banks):
    1. Total Cost = $0.7399
    2. Entities Extracted = 53
    3. Validated Entities = 42
    4. Filtered Entities = 53 - 42 = 11
    5. Wasted Cost = $0.7399 × (11/53) = $0.7399 × 0.2075 = $0.1525

Effective Cost (USD)
  - Cost spent on validated entities (useful spending)
  - Formula: Total Pipeline Cost - Wasted Cost
  - Example: $0.7399 - $0.1525 = $0.5874

Wasted Percentage (%)
  - Percentage of total cost that was wasted
  - Formula: (Wasted Cost / Total Pipeline Cost) × 100%
  - Same as Cost Waste Ratio but expressed in cost terms
  - Example: ($0.1525 / $0.7399) × 100% = 20.61%

====================================================================================================
5. AGGREGATED METRICS
====================================================================================================

Method-level Aggregation:
  - Sum all costs across documents for each method
  - Calculate overall retention rates
  - Compare Baseline vs Ontology-Guided performance

Per-Document Breakdown:
  - Individual document costs and metrics
  - Identifies best/worst performing documents
  - Shows variation in validation difficulty

====================================================================================================
6. FILE-SPECIFIC CALCULATIONS
====================================================================================================

comparison_simplified_metrics.csv:
  - Baseline Cost per Validated Entity = $4.4820 / 28 = $0.1594/entity
  - Baseline Cost Waste Ratio = 97.23%
  - Ontology-Guided Cost per Validated Entity = $4.5615 / 295 = $0.0155/entity
  - Ontology-Guided Cost Waste Ratio = 18.80%

ontology_simplified_metrics.csv (per document):
  Document                  | Total Cost | Validated | Cost/Entity | Waste Ratio
  --------------------------|------------|-----------|-------------|-------------
  SASB Banks                | $0.7399    | 42        | $0.0176     | 20.75%
  SASB Semiconductors       | $0.8784    | 62        | $0.0142     | 10.14%
  IFRS S2                   | $0.8554    | 68        | $0.0126     | 15.00%
  Australia AASB            | $0.9097    | 66        | $0.0138     | 10.81%
  TCFD Report               | $1.1781    | 57        | $0.0207     | 35.23%

ontology_guided_per_document_cost.csv:
  - Contains raw data: Stage 2 Cost, Stage 3 Cost, Total Cost
  - Entities Extracted and Validated counts
  - Retention Rate and Wasted Cost calculations

comparison_wasted_cost.csv:
  - Effective Cost = Useful spending on validated entities
  - Wasted Cost = Spending on filtered entities
  - Total Cost = Effective + Wasted
  - Wasted Percentage = Cost Waste Ratio

====================================================================================================
7. KEY INSIGHTS FROM CALCULATIONS
====================================================================================================

Cost Efficiency:
  - Ontology-Guided achieves 10.3x better cost per validated entity
  - This is due to higher precision in Stage 2 extraction

Waste Reduction:
  - Baseline: 97.23% waste ratio (extracts many low-quality entities)
  - Ontology-Guided: 18.80% waste ratio (extracts mostly valid entities)
  - 78.43 percentage point reduction in waste

Total Cost Comparison:
  - Baseline total: $4.4820
  - Ontology-Guided total: $4.5615
  - Only 1.8% higher total cost, but 10.3x better efficiency

Quality vs Quantity:
  - Baseline: 364 extracted → 28 validated (7.7% retention)
  - Ontology-Guided: 364 extracted → 295 validated (81.0% retention)
  - Ontology guidance dramatically improves extraction precision

Document Variation:
  - Best: IFRS S2 ($0.0126/entity, 15.00% waste)
  - Worst: TCFD Report ($0.0207/entity, 35.23% waste)
  - Shows some documents are harder to extract accurately

====================================================================================================
8. FORMULA REFERENCE CARD
====================================================================================================

Cost per Validated Entity     = (Stage 2 Cost + Stage 3 Cost) / Validated Entities
Cost Waste Ratio               = (Filtered Entities / Total Extracted) × 100%
Wasted Cost                    = Total Cost × (Filtered Entities / Total Extracted)
Effective Cost                 = Total Cost - Wasted Cost
Retention Rate                 = (Validated Entities / Total Extracted) × 100%
Filtered Entities              = Total Extracted - Validated Entities
Total Pipeline Cost            = Stage 2 Cost + Stage 3 Cost

====================================================================================================
END OF SUMMARY
====================================================================================================
